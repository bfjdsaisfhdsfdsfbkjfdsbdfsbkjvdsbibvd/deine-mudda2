-- Advanced Professional Command Bar
-- Comprehensive, elegant command interface with enhanced user experience

-- Services
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")

-- Sophisticated Color Palette
local PALETTE = {
    BACKGROUND = {
        DARK = Color3.fromRGB(42, 47, 55),      -- Deep slate background
        LIGHT = Color3.fromRGB(53, 59, 69)      -- Slightly lighter variant
    },
    TEXT = {
        PRIMARY = Color3.fromRGB(235, 236, 240),   -- Soft white
        SECONDARY = Color3.fromRGB(156, 163, 175)  -- Muted gray
    },
    ACCENT = {
        MAIN = Color3.fromRGB(59, 130, 246),       -- Professional blue
        HOVER = Color3.fromRGB(79, 150, 266)       -- Slightly brighter blue
    },
    BORDER = Color3.fromRGB(75, 85, 99)            -- Dark border color
}

-- Advanced Configuration
local CONFIG = {
    ANIMATION = {
        DURATION = 0.4,
        EASING_STYLE = Enum.EasingStyle.Quad,
        EASING_DIRECTION = Enum.EasingDirection.Out
    },
    DIMENSIONS = {
        WIDTH = 550,
        HEIGHT = 55,
        CORNER_RADIUS = 12
    },
    TYPOGRAPHY = {
        FONT = Enum.Font.GothamSemibold,
        SIZE = 16
    }
}

-- Utility Functions
local function createProfessionalShadow(parent)
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "ProfessionalShadow"
    shadow.Image = "rbxassetid://7014506339"  -- High-quality shadow
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(64, 64, 256, 256)
    shadow.Size = UDim2.new(1, 40, 1, 40)
    shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
    shadow.AnchorPoint = Vector2.new(0.5, 0.5)
    shadow.BackgroundTransparency = 1
    shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    shadow.ImageTransparency = 0.7
    shadow.ZIndex = -1
    shadow.Parent = parent
    return shadow
end

-- Command Handling Logic
local function handleCommand(text)
    if not text or text == "" then return end
    
    local cleanText = text:match("^%s*(.-)%s*$"):lower()
    
    -- Prepend "!" to the command before checking
    local commandKey = "!"..cleanText
    
    -- Dynamic command processing
    if _G.cmds and _G.cmds[commandKey] then
      local commandURL = _G.cmds[commandKey]
      if not commandURL then
        warn("[Command Bar] Command URL not found for: " .. commandKey)
        return
      end

      local success, commandString, errorMessage
      success, commandString = pcall(game.HttpGet, game, commandURL)

      if not success then
          warn("[Command Bar] Failed to fetch command from " .. commandURL .. ": ", commandString)
          return
      end

      local commandFunction = loadstring(commandString)
        
      if not commandFunction then
        warn("[Command Bar] Failed to load command from " .. commandURL .. ". Invalid code.")
         return
      end
        
      success, errorMessage = pcall(commandFunction)
        
      if not success then
        warn("[Command Bar] Error executing command from " .. commandURL .. ": " .. tostring(errorMessage))
      end
    else
      warn("[Command Bar] Command not found: " .. commandKey)
    end
end

-- Advanced UI Construction
local function createAdvancedCommandBar()
    local gui = Instance.new("ScreenGui")
    gui.Name = "AdvancedCommandBarUI"
    gui.ResetOnSpawn = false
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local container = Instance.new("Frame")
    container.Name = "CommandBarContainer"
    container.Size = UDim2.new(0, CONFIG.DIMENSIONS.WIDTH, 0, CONFIG.DIMENSIONS.HEIGHT)
    container.Position = UDim2.new(0.5, 0, 1.1, 0)
    container.AnchorPoint = Vector2.new(0.5, 1)
    container.BackgroundTransparency = 1

    local background = Instance.new("Frame")
    background.Name = "Background"
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = PALETTE.BACKGROUND.DARK
    background.BorderSizePixel = 0
    background.Parent = container

    -- Gradient Effect
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, PALETTE.BACKGROUND.DARK),
        ColorSequenceKeypoint.new(1, PALETTE.BACKGROUND.LIGHT)
    })
    gradient.Rotation = 90
    gradient.Parent = background

    -- Rounded Corners
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, CONFIG.DIMENSIONS.CORNER_RADIUS)
    corner.Parent = background

    -- Professional Shadow
    createProfessionalShadow(background)

    -- Sophisticated Border
    local stroke = Instance.new("UIStroke")
    stroke.Color = PALETTE.BORDER
    stroke.Thickness = 1
    stroke.Transparency = 0.5
    stroke.Parent = background

    -- Command Input Field
    local textBox = Instance.new("TextBox")
    textBox.Name = "CommandInput"
    textBox.Size = UDim2.new(0.85, -20, 1, 0)
    textBox.Position = UDim2.new(0.15, 0, 0, 0)
    textBox.BackgroundTransparency = 1
    textBox.Text = ""
    textBox.PlaceholderText = "Enter command (Press F to toggle)"
    textBox.TextColor3 = PALETTE.TEXT.PRIMARY
    textBox.PlaceholderColor3 = PALETTE.TEXT.SECONDARY
    textBox.TextXAlignment = Enum.TextXAlignment.Left
    textBox.TextSize = CONFIG.TYPOGRAPHY.SIZE
    textBox.Font = CONFIG.TYPOGRAPHY.FONT
    textBox.ClearTextOnFocus = false
    textBox.Parent = background

    -- Icon with Hover Effect
    local icon = Instance.new("ImageButton")
    icon.Name = "CommandIcon"
    icon.Size = UDim2.new(0, 45, 0, 45)
    icon.Position = UDim2.new(0.02, 0, 0.5, -22.5)
    icon.BackgroundTransparency = 1
    icon.Image = "rbxassetid://130728175890553"  -- Confirmed asset ID
    icon.ImageColor3 = PALETTE.ACCENT.MAIN
    
    -- Hover color transition
    icon.MouseEnter:Connect(function()
        TweenService:Create(icon, 
            TweenInfo.new(0.2), 
            {ImageColor3 = PALETTE.ACCENT.HOVER}
        ):Play()
    end)
    icon.MouseLeave:Connect(function()
        TweenService:Create(icon, 
            TweenInfo.new(0.2), 
            {ImageColor3 = PALETTE.ACCENT.MAIN}
        ):Play()
    end)
    
    icon.Parent = background

    container.Parent = gui
    return gui, container, textBox, icon
end

-- Command Bar Initialization
local function initializeAdvancedCommandBar()
    local gui, container, textBox, icon = createAdvancedCommandBar()
    local localPlayer = Players.LocalPlayer
    
    -- Initialize _G.cmds
    _G.cmds = {}
    
    -- Safe command loading
    local success, loadError = pcall(function()
        local commandMappings = game:HttpGet("https://raw.githubusercontent.com/bfjdsaisfhdsfdsfbkjfdsbdfsbkjvdsbibvd/deinemudda/refs/heads/main/allcmdss.luau")
        loadstring(commandMappings)()
        print("Loaded commands:")
        for k, v in pairs(_G.cmds) do
            print(k, v)
        end
    end)
    
    if not success then
        warn("[Command Bar] Failed to load dynamic commands:", loadError)
    end
    
    gui.Parent = localPlayer:WaitForChild("PlayerGui")
    
    -- Smooth Entry Animation
    TweenService:Create(container, 
        TweenInfo.new(
            CONFIG.ANIMATION.DURATION, 
            CONFIG.ANIMATION.EASING_STYLE, 
            CONFIG.ANIMATION.EASING_DIRECTION
        ), 
        {Position = UDim2.new(0.5, 0, 0.95, 0)}
    ):Play()
    
    -- Command Submission Handler
    textBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and textBox.Text ~= "" then
            handleCommand(textBox.Text)
            textBox.Text = ""
        end
    end)
    
    -- Bar Toggle Mechanism
    local isVisible = true
    local function toggleBar()
        isVisible = not isVisible
        
        local targetPosition = isVisible and 
            UDim2.new(0.5, 0, 0.95, 0) or 
            UDim2.new(0.5, 0, 1.1, 0)
        
        TweenService:Create(container, 
            TweenInfo.new(
                CONFIG.ANIMATION.DURATION, 
                CONFIG.ANIMATION.EASING_STYLE, 
                CONFIG.ANIMATION.EASING_DIRECTION
            ), 
            {Position = targetPosition}
        ):Play()
    end
    
    icon.MouseButton1Click:Connect(toggleBar)
    
    -- Keybind Handling
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == Enum.KeyCode.F then
            toggleBar()
        end
    end)
end

-- Launch Advanced Command Bar
initializeAdvancedCommandBar()
